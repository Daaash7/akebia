{% include 'header.html' %}
{% set ns = namespace(total=0) %}
<main class="main-oform">
    <h2 class="order-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
    <div class="order-container">
        <form id="order" class="address-form" action="/order/create" method="post" accept-charset="utf-8"
      enctype="multipart/form-data">
            <h3>–ê–¥—Ä–µ—Å:</h3>
            <input id="address" name="address" type="text" placeholder="–ê–¥—Ä–µ—Å"  required>
        </form>

        <div class="order-summary">
            <h3>–ó–∞–∫–∞–∑:</h3>
            <div class="order-items">
                {% for product_card in cart %}

                {% if product_card.count > 0 %}

                <div class="order-item">
                    <img src="../static/img/products_images/{{product_card.product.image_filename}}" alt="{{product_card.product.name}}">
                    <div class="item-content">
                        <div class="item-info">
                            <p><strong>{{product_card.product.name}}</strong></p>
                            <p>–¶–µ–Ω–∞: {{product_card.new_price.price}} ‚ÇΩ</p>
                            {% set ns.total = ns.total + product_card.new_price.price %}
                            <p>–ê—Ä—Ç–∏–∫—É–ª: {{product_card.product.product_code}}</p>
                        </div>
                        <button class="remove-btn" onclick="del_from_cart({{product_card.product.id}})">üóë</button>
                    </div>
                </div>
                {% endif %}

                {% endfor %}

            </div>
        </div>

        <div class="payment-summary">
            <h3>–ö –æ–ø–ª–∞—Ç–µ:</h3>
            <div class="payment-details">
                <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤: <strong>{{(cart | selectattr('count', '>', 0) | list | length)}}</strong></p>
                <p>–°—É–º–º–∞: <strong>{{ns.total}} ‚ÇΩ</strong></p>
            </div>
            <p class="payment-note"><span class="asterisk">*</span> –û–ø–ª–∞—Ç–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</p>
            <input type="submit" class="order-btn" form="order">

        </div>

    </div>
</main>
<script>
    async function del_from_cart(product_id) {
        event.preventDefault()
        const response = await fetch('/product/del_from_cart?pr_id=' + product_id, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        const json_res = await response.json();
        if (json_res.status_code === 401) {
            window.location.reload();
        } else if (response.status === 200) {
            window.location.reload();
        } else {
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä. –í–æ–∑–º–æ–∂–Ω–æ –æ–Ω —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω–µ.")
        }
    }
</script>

{% include 'footer.html' %}


